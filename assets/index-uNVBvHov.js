import{r as Q,g as j}from"./phaser-CFjeuDV9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var Z=Q();const b=j(Z);var u=(o=>(o.TitleScene="TitleScene",o.ShapeRepairScene="ShapeRepairScene",o.BubblePopScene="BubblePopScene",o))(u||{});function p(o,t){return o=Math.ceil(o),t=Math.floor(t),Math.floor(Math.random()*(t-o+1)+o)}function I(o){return o.splice(Math.floor(Math.random()*o.length),1)[0]}const J=[15079755,3978315,16769305,4416472,16089649,9510580,4379892,15741670,12578629,16432852,4626832,14466815,10117924,16775880,8388608,11206595,8421376,16767153,117,11119017,16777215,0];function N(){let o=[];return()=>(o.length===0&&(o=[...J]),I(o))}const tt={victory:"assets/audio/sparkle.mp3",whoosh:"assets/audio/whoosh.mp3",pop:"assets/audio/pop.mp3"},T=new Map;function C(o,t,e){const i=`${t}Sound`;if(T.has(t)){const s=T.get(t);o[i]=s,e?.(s);return}o[i]?e?.(o[i]):o.load.audio(t,[tt[t]]).once(`filecomplete-audio-${t}`,()=>{o[i]=o.sound.add(t),T.set(t,o[i]),e?.(o[i])})}function _(o,t){if(console.log(`playSound called for ${t} in scene ${o.scene.key}`),!o.sound){console.log("No sound manager available");return}if(T.has(t)){const i=T.get(t);try{console.log(`Playing cached sound for ${t}`),i.play();return}catch{console.log(`Cached sound for ${t} is invalid, removing from cache`),T.delete(t)}}const e=`${t}Sound`;if(o[e]&&o[e].scene===o){console.log(`Playing scene-local sound for ${t}`),o[e].play();return}o.cache.audio.exists(t)?(console.log(`Creating new sound for ${t} from existing audio cache`),o[e]=o.sound.add(t),T.set(t,o[e]),o[e].play()):(console.log(`Loading audio for ${t}`),C(o,t,i=>{console.log(`Playing newly loaded sound for ${t}`),i?.play?.()}))}class et extends b.Scene{constructor(){super(u.BubblePopScene)}STORAGE_KEYS={BUBBLE_COUNT:"bubblePopScene_bubbleCount",DRAG_TO_KILL_ENABLED:"bubblePopScene_dragToKillEnabled"};bubbleSize=200;TOTAL_BUBBLES=50;REFILL_DELAY=0;dragToKillEnabled=!1;isResetting=!1;preload(){this.load.image("bubble","assets/images/bubble.png"),this.load.image("spark","assets/images/particle.png"),C(this,"pop"),C(this,"victory")}create(){console.log("create bubble scene"),this.loadSettings(),this.cleanupBubbles(),this.addBackButton(),this.addProgressCounter(),this.computeSizing(),this.createBubbleGrid(),this.scale.on("resize",this.handleResize,this),this.setupDragToKill()}loadSettings(){try{const t=localStorage.getItem(this.STORAGE_KEYS.BUBBLE_COUNT);if(t!==null){const i=parseInt(t,10);isNaN(i)||(this.TOTAL_BUBBLES=i)}const e=localStorage.getItem(this.STORAGE_KEYS.DRAG_TO_KILL_ENABLED);e!==null&&(this.dragToKillEnabled=e==="true")}catch(t){console.warn("Failed to load settings from localStorage:",t)}}saveSettings(){try{localStorage.setItem(this.STORAGE_KEYS.BUBBLE_COUNT,this.TOTAL_BUBBLES.toString()),localStorage.setItem(this.STORAGE_KEYS.DRAG_TO_KILL_ENABLED,this.dragToKillEnabled.toString())}catch(t){console.warn("Failed to save settings to localStorage:",t)}}createBubbleGrid(){this.createBubbleBucket(),this.fillBubbleGrid()}createBubbleBucket(){let t=this.TOTAL_BUBBLES;if(this.TOTAL_BUBBLES===-1){const e=this.getTopMargin(),i=this.gameHeight-e,s=Math.round(this.gameWidth/this.bubbleSize),n=Math.round(i/this.bubbleSize);t=s*n*2}for(let e=0;e<t;e++){const i=this.createBubble(0,0);i.setVisible(!1),i.setAlpha(1),i.x=-1e3,i.y=-1e3,this.bubbleBucket.push(i)}}fillBubbleGrid(){const t=this.getTopMargin(),e=this.gameHeight-t,i=Math.round(this.gameWidth/this.bubbleSize),s=Math.round(e/this.bubbleSize),n=i*s,a=[],l=[];this.bubbles.forEach(r=>{const d=Math.round((r.x-this.bubbleSize/2)/this.bubbleSize),h=Math.round((r.y-t-this.bubbleSize/2)/this.bubbleSize);d>=0&&d<i&&h>=0&&h<s?a.push(r):l.push(r)}),l.forEach(r=>{r.setVisible(!1),r.setAlpha(1),r.x=-1e3,r.y=-1e3,this.bubbleBucket.push(r),this.bubbles.delete(r)});const c=new Set;a.forEach(r=>{const d=Math.round((r.x-this.bubbleSize/2)/this.bubbleSize),h=Math.round((r.y-t-this.bubbleSize/2)/this.bubbleSize);c.add(`${h},${d}`)});const f=n-a.length;let S=Math.min(f,this.bubbleBucket.length);if(this.TOTAL_BUBBLES===-1&&this.bubbleBucket.length<f){const r=f-this.bubbleBucket.length;for(let d=0;d<r;d++){const h=this.createBubble(0,0);h.setVisible(!1),h.setAlpha(1),h.x=-1e3,h.y=-1e3,this.bubbleBucket.push(h)}S=f}let g=0;for(let r=0;r<s&&g<S;r++)for(let d=0;d<i&&g<S;d++){const h=`${r},${d}`;if(!c.has(h)){const m=this.bubbleBucket.shift();m.x=d*this.bubbleSize+this.bubbleSize/2,m.y=r*this.bubbleSize+this.bubbleSize/2+t,m.setVisible(!0),m.setAlpha(1),this.resetBubbleInteractivity(m),this.bubbles.add(m),g++}}}handleResize(){this.repositionProgressCounter(),this.repositionButtons(),this.fillBubbleGrid()}getUIScaleFactor(){const t=Math.min(this.gameWidth,this.gameHeight);return Math.max(.7,Math.min(2,t/600))}repositionButtons(){const t=this.getUIScaleFactor();if(this.backButton){const e=Math.round(60*t),i=Math.round(25*t),s=Math.round(12*t);this.backButton.setStyle({fontSize:`${e}px`}),this.backButton.setPadding(i,0,i,s)}if(this.settingsButton){const e=Math.round(45*t),i=Math.round(18*t),s=Math.round(12*t);if(this.backButton){const n=this.backButton.getBounds(),a=n.right+Math.round(25*t)*.5,l=n.centerY;this.settingsButton.setPosition(a,l)}this.settingsButton.setStyle({fontSize:`${e}px`}),this.settingsButton.setPadding(i,s,i,s)}if(this.progressText){const e=Math.round(32*t),i=Math.round(20*t),s=Math.round(10*t);this.progressText.setStyle({fontSize:`${e}px`}),this.progressText.setPadding(i,s,i,s)}}fillSpecificSpot(t,e){if(this.isResetting)return;const i=`${t},${e}`;this.pendingRefills.has(i)||(this.bubbleBucket.length>0||this.TOTAL_BUBBLES===-1)&&(this.pendingRefills.add(i),this.time.delayedCall(this.REFILL_DELAY,()=>{if(this.isResetting){this.pendingRefills.delete(i);return}this.pendingRefills.delete(i);let s;if(this.bubbleBucket.length>0)s=this.bubbleBucket.shift();else if(this.TOTAL_BUBBLES===-1)s=this.createBubble(t,e);else return;this.isPositionEmpty(t,e)&&(this.tweens.killTweensOf(s),s.floatTween&&(s.floatTween.destroy(),s.floatTween=null),s.x=t,s.y=e,s.setVisible(!0),this.bubbles.add(s),this.resetBubbleInteractivity(s),s.setAlpha(0),this.tweens.add({targets:s,alpha:1,ease:"Cubic.easeInOut",duration:1500,onComplete:()=>{}}))}))}isPositionEmpty(t,e){for(const s of this.bubbles)if(Math.abs(s.x-t)<10&&Math.abs(s.y-e)<10)return!1;return!0}finalize(){_(this,"victory"),this.addPlayAgainButton()}cleanupBubbles(t=!1){this.pendingRefills.clear(),this.time.removeAllEvents(),this.settingsPanelVisible&&!t&&(this.settingsPanel?.destroy(),this.settingsBackground?.destroy(),this.settingsPanelVisible=!1),this.bubbles.forEach(e=>{this.tweens.killTweensOf(e),e.floatTween&&e.floatTween.destroy(),e.removeAllListeners(),e.destroy()}),this.bubbles.clear(),this.bubbleBucket.forEach(e=>{this.tweens.killTweensOf(e),e.floatTween&&e.floatTween.destroy(),e.removeAllListeners(),e.destroy()}),this.bubbleBucket=[],this.bubblesPopped=0,this.pendingRefills.clear(),this.particleManagers.forEach(e=>{e.destroy()}),this.particleManagers.clear()}backButton;settingsButton;progressText;progressHint;settingsPanel;settingsBackground;settingsPanelVisible=!1;popSound;colorFactory=N();bubbleWidth=0;bubbleHeight=0;get gameWidth(){return this.scale.gameSize.width}get gameHeight(){return this.scale.gameSize.height}bubbles=new Set;particleManagers=new Set;bubbleBucket=[];bubblesPopped=0;pendingRefills=new Set;popBubble(t){if(!this.bubbles.has(t)){console.log("Attempted to pop bubble not in active set");return}this.tweens.killTweensOf(t);const e=t.x,i=t.y,s=50;var n=this.add.particles(t.x,t.y,"spark",{speed:2e3,quantity:5,gravityY:13e3,scale:{min:.05,max:.1},x:{min:-s,max:s},y:{min:-s,max:s}});this.particleManagers.add(n),this.popSound?.play(),this.bubbles.delete(t),this.bubblesPopped++,this.updateProgressCounter(),this.tweens.add({targets:t,scaleX:0,scaleY:0,ease:"Sine.easeInOut",duration:100,onComplete:()=>{t.destroy(),n.stop(),this.time.delayedCall(2e3,()=>{this.particleManagers.delete(n),n.destroy()}),this.fillSpecificSpot(e,i),this.TOTAL_BUBBLES!==-1&&this.bubblesPopped>=this.TOTAL_BUBBLES&&this.finalize()}})}createBubble(t,e){const i=this.make.sprite({key:"bubble"});return i.displayWidth=this.bubbleSize,i.displayHeight=this.bubbleSize,i.setTint(this.colorFactory()),i.setInteractive({cursor:"pointer"}),i}computeSizing(){const t=this.createBubble(0,0);this.bubbleWidth=t.displayWidth,this.bubbleHeight=t.displayHeight,t.destroy()}addBackButton(){const t=this.getUIScaleFactor(),e=Math.round(60*t),i=Math.round(25*t),s=Math.round(12*t);this.backButton=this.add.text(10,10,"←",{fontSize:`${e}px`,color:"white"}).setOrigin(0).setPadding(i,0,i,s).setStyle({backgroundColor:"#111"}).setInteractive({useHandCursor:!0}).on("pointerdown",(g,r,d,h)=>{h.stopPropagation(),this.scene.restart(),this.scene.switch(u.TitleScene)}).setDepth(10).on("pointerover",()=>this.backButton.setStyle({fill:"#f39c12"})).on("pointerout",()=>this.backButton.setStyle({fill:"#FFF"}));const n=Math.round(45*t),a=Math.round(18*t),l=Math.round(12*t),c=this.backButton.getBounds(),f=c.right+i*.5,S=c.centerY;this.settingsButton=this.add.text(f,S,"⚙",{fontSize:`${n}px`,color:"white"}).setOrigin(0,.5).setPadding(a,l,a,l).setStyle({backgroundColor:"#333"}).setInteractive({useHandCursor:!0}).on("pointerdown",(g,r,d,h)=>{h.stopPropagation(),this.toggleSettingsPanel()}).setDepth(10).on("pointerover",()=>this.settingsButton.setStyle({fill:"#f39c12",backgroundColor:"#555"})).on("pointerout",()=>this.settingsButton.setStyle({fill:"#FFF",backgroundColor:"#333"}))}addPlayAgainButton(){const t=this.getUIScaleFactor(),e=Math.round(48*t),i=Math.round(50*t);var s=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Play Again",{fontSize:`${e}px`,color:"white"}).setOrigin(.5).setPadding(i).setResolution(10).setStyle({backgroundColor:"green"}).setInteractive({useHandCursor:!0}).on("pointerdown",(n,a,l,c)=>{c.stopPropagation(),this.cleanupBubbles(),this.scene.restart()}).setDepth(10).on("pointerover",()=>s.setStyle({fill:"#f39c12"})).on("pointerout",()=>s.setStyle({fill:"#FFF"}))}addProgressCounter(){const t=this.getUIScaleFactor(),e=Math.round(32*t),i=Math.round(20*t),s=Math.round(10*t),n=this.TOTAL_BUBBLES===-1?"Bubbles: ∞":`Bubbles: ${this.TOTAL_BUBBLES}`;this.progressText=this.add.text(this.scale.gameSize.width-10,10,n,{fontSize:`${e}px`,color:"white"}).setOrigin(1,0).setPadding(i,s,i,s).setStyle({backgroundColor:"#333"}).setDepth(10)}setBubbleCount(t){this.TOTAL_BUBBLES=t,this.saveSettings();const e=this.TOTAL_BUBBLES===-1?"Bubbles: ∞":`Bubbles: ${this.TOTAL_BUBBLES}`;this.progressText.setText(e),this.resetGame(!0)}resetGame(t=!1){this.isResetting=!0,this.cleanupBubbles(t),this.bubblesPopped=0,this.bubbleBucket=[],this.time.delayedCall(50,()=>{this.createBubbleBucket(),this.fillBubbleGrid(),this.updateProgressCounter(),this.isResetting=!1})}updateProgressCounter(){if(this.TOTAL_BUBBLES===-1)this.progressText.setText(`Bubbles: ${this.bubblesPopped} popped`);else{const t=this.TOTAL_BUBBLES-this.bubblesPopped;this.progressText.setText(`Bubbles: ${t}`)}}resetBubbleInteractivity(t){const e=t.x,i=t.y;this.tweens.killTweensOf(t),t.floatTween&&(t.floatTween.destroy(),t.floatTween=null),t.x=e,t.y=i,t.removeAllListeners(),t.setInteractive({cursor:"pointer"}),this.dragToKillEnabled||t.on("pointerdown",()=>{this.settingsPanelVisible||this.bubbles.has(t)&&this.popBubble(t)});const s=this.tweens.add({targets:t,props:{x:{value:`+=${p(1,10)}`,duration:p(1e3,1500),delay:p(1,1e3),ease:"Sine.easeInOut"},y:{value:`+=${p(1,10)}`,duration:p(2e3,2500),delay:p(1,1e3),ease:"Sine.easeInOut"},scaleX:{value:`+=.0${p(1,3)}`,duration:p(2e3,3e3),delay:p(1,1e3),ease:"Sine.easeInOut"},scaleY:{value:`+=.0${p(1,3)}`,duration:p(1e3,2e3),delay:p(1,1e3),ease:"Sine.easeInOut"}},repeat:-1,yoyo:!0});t.floatTween=s}repositionProgressCounter(){this.progressText&&this.progressText.setPosition(this.scale.gameSize.width-10,10),this.progressHint&&this.progressHint.setPosition(this.scale.gameSize.width-10,60)}setupDragToKill(){let t=!1,e=null;this.input.on("pointerdown",i=>{if(this.dragToKillEnabled&&!this.settingsPanelVisible){t=!0,e=null;const s=this.getBubbleAtPosition(i.x,i.y);s&&(this.popBubble(s),e=s)}}),this.input.on("pointerup",()=>{t=!1,e=null}),this.input.on("pointermove",i=>{if(this.dragToKillEnabled&&t&&!this.settingsPanelVisible){const s=this.getBubbleAtPosition(i.x,i.y);s&&s!==e&&(this.popBubble(s),e=s)}})}getBubbleAtPosition(t,e){for(const i of this.bubbles)if(i.getBounds().contains(t,e))return i;return null}toggleSettingsPanel(){this.settingsPanelVisible?this.hideSettingsPanel():this.showSettingsPanel()}showSettingsPanel(){if(this.settingsPanelVisible)return;const t=this.getUIScaleFactor();this.settingsBackground=this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.gameWidth,this.gameHeight,0,.7).setDepth(20).setInteractive(),this.settingsPanel=this.add.container(this.cameras.main.centerX,this.cameras.main.centerY),this.settingsPanel.setDepth(21);const e=Math.round(600*t),i=Math.round(600*t),s=this.add.rectangle(0,0,e,i,3355443);s.setStrokeStyle(Math.round(3*t),5592405);const n=Math.round(48*t),a=Math.round(-260*t),l=this.add.text(0,a,"Settings",{fontSize:`${n}px`,color:"white",fontStyle:"bold"}).setOrigin(.5),c=Math.round(56*t),f=Math.round(260*t),S=Math.round(16*t),g=Math.round(12*t),r=this.add.text(f,a,"×",{fontSize:`${c}px`,color:"white"}).setOrigin(.5).setPadding(S,g,S,g).setStyle({backgroundColor:"#666"}).setInteractive({useHandCursor:!0}).on("pointerdown",()=>this.hideSettingsPanel()).on("pointerover",()=>r.setStyle({fill:"#f39c12",backgroundColor:"#888"})).on("pointerout",()=>r.setStyle({fill:"#FFF",backgroundColor:"#666"})),d=Math.round(32*t),h=Math.round(-180*t),m=this.add.text(0,h,"Bubble Count:",{fontSize:`${d}px`,color:"white",fontStyle:"bold"}).setOrigin(.5),F=Math.round(-120*t),v=Math.round(32*t),H=Math.round(28*t),k=Math.round(16*t),P=Math.round(12*t),E=this.add.text(Math.round(-120*t),F,"-5",{fontSize:`${v}px`,color:"white"}).setOrigin(.5).setPadding(k,P,k,P).setStyle({backgroundColor:"#555"}).setInteractive({useHandCursor:!0}).on("pointerdown",(O,A,R,y)=>{if(y.stopPropagation(),this.TOTAL_BUBBLES===-1)this.setBubbleCount(45),this.updateInfiniteButtonAndCountText(x,w);else{const B=Math.max(5,this.TOTAL_BUBBLES-5);this.setBubbleCount(B),w.setText(B.toString())}}).on("pointerover",()=>E.setStyle({fill:"#f39c12",backgroundColor:"#777"})).on("pointerout",()=>E.setStyle({fill:"#FFF",backgroundColor:"#555"})),D=this.TOTAL_BUBBLES===-1?"∞":this.TOTAL_BUBBLES.toString(),w=this.add.text(0,F,D,{fontSize:`${H}px`,color:"white"}).setOrigin(.5).setPadding(Math.round(20*t),Math.round(10*t),Math.round(20*t),Math.round(10*t)).setStyle({backgroundColor:"#222",borderColor:"#666",borderWidth:2}),z=this.add.text(Math.round(120*t),F,"+5",{fontSize:`${v}px`,color:"white"}).setOrigin(.5).setPadding(k,P,k,P).setStyle({backgroundColor:"#555"}).setInteractive({useHandCursor:!0}).on("pointerdown",(O,A,R,y)=>{if(y.stopPropagation(),this.TOTAL_BUBBLES===-1)this.setBubbleCount(55),this.updateInfiniteButtonAndCountText(x,w);else{const B=this.TOTAL_BUBBLES+5;this.setBubbleCount(B),w.setText(B.toString())}}).on("pointerover",()=>z.setStyle({fill:"#f39c12",backgroundColor:"#777"})).on("pointerout",()=>z.setStyle({fill:"#FFF",backgroundColor:"#555"})),X=Math.round(-60*t),x=this.add.text(0,X,this.TOTAL_BUBBLES===-1?"Exit Infinite":"Infinite Mode",{fontSize:`${v}px`,color:"white"}).setOrigin(.5).setPadding(Math.round(24*t),P,Math.round(24*t),P).setStyle({backgroundColor:this.TOTAL_BUBBLES===-1?"#cc6600":"#006600"}).setInteractive({useHandCursor:!0}).on("pointerdown",(O,A,R,y)=>{y.stopPropagation(),this.TOTAL_BUBBLES===-1?this.setBubbleCount(50):this.setBubbleCount(-1),this.updateInfiniteButtonAndCountText(x,w)}).on("pointerover",()=>x.setStyle({fill:"#f39c12"})).on("pointerout",()=>x.setStyle({fill:"#FFF"})),Y=Math.round(100*t),V=this.add.text(Math.round(-200*t),Y,"Drag Mode:",{fontSize:`${d}px`,color:"white"}).setOrigin(0,.5),K=Math.round(32*t),U=Math.round(32*t),$=Math.round(16*t),M=this.add.text(Math.round(80*t),Y,this.dragToKillEnabled?"ON":"OFF",{fontSize:`${K}px`,color:"white"}).setOrigin(.5).setPadding(U,$,U,$).setStyle({backgroundColor:this.dragToKillEnabled?"#006600":"#666"}).setInteractive({useHandCursor:!0}).on("pointerdown",(O,A,R,y)=>{y.stopPropagation(),this.dragToKillEnabled=!this.dragToKillEnabled,M.setText(this.dragToKillEnabled?"ON":"OFF"),M.setStyle({backgroundColor:this.dragToKillEnabled?"#006600":"#666"}),this.saveSettings(),this.time.delayedCall(10,()=>{this.bubbles.forEach(B=>{this.resetBubbleInteractivity(B)})})}).on("pointerover",()=>M.setStyle({fill:"#f39c12"})).on("pointerout",()=>M.setStyle({fill:"#FFF"})),G=Math.round(22*t),q=Math.round(160*t),W=this.add.text(0,q,`When enabled, drag to pop bubbles
instead of clicking`,{fontSize:`${G}px`,color:"#ccc",align:"center"}).setOrigin(.5);this.settingsPanel.add([s,l,r,m,E,w,z,x,V,M,W]),this.settingsPanel.setAlpha(0),this.settingsPanel.setScale(.8),this.tweens.add({targets:this.settingsPanel,alpha:1,scaleX:1,scaleY:1,duration:200,ease:"Back.easeOut"}),this.settingsPanelVisible=!0,this.settingsBackground.on("pointerdown",()=>this.hideSettingsPanel())}hideSettingsPanel(){this.settingsPanelVisible&&this.tweens.add({targets:this.settingsPanel,alpha:0,scaleX:.8,scaleY:.8,duration:150,ease:"Back.easeIn",onComplete:()=>{this.settingsPanel?.destroy(),this.settingsBackground?.destroy(),this.settingsPanelVisible=!1}})}getTopMargin(){const t=this.getUIScaleFactor();return Math.round(60*t)+Math.round(12*t*2)-10}updateInfiniteButtonAndCountText(t,e){this.TOTAL_BUBBLES===-1?(t.setText("Exit Infinite"),t.setStyle({backgroundColor:"#cc6600"}),e.setText("∞")):(t.setText("Infinite Mode"),t.setStyle({backgroundColor:"#006600"}),e.setText(this.TOTAL_BUBBLES.toString()))}}class st extends b.Scene{constructor(){super(u.ShapeRepairScene)}quadrantColumnCount=3;quadrantRowCount=3;resetPositionSpeed=4500;preload(){C(this,"whoosh"),C(this,"victory")}create(){console.log("create shape scene"),this.reset(),this.addBackButton(),this.calculateQuadrants(this.quadrantColumnCount,this.quadrantRowCount),this.drawQuadrants();const t=[...this.quadrants],e=[...this.distinctColors];for(;t.length>0;){const s=I(t),n=I(t);s&&n&&(this.createShapePair(e.shift(),s,n),this.pairsRemaining++)}console.log("Total pairs created:",this.pairsRemaining),this.input.on("drag",function(s,n,a,l){n.x=a,n.y=l});const i=new Map;this.input.on("dragstart",(s,n,a,l)=>{n.depth=1,i.set(n,{x:n.x,y:n.y})}),this.input.on("dragend",(s,n,a,l)=>{n.depth=0;const c=n.getBounds(),S=this.shapePairMap.get(n)?.getBounds();if(console.log("Drag ended. Checking collision between sprite and partner"),console.log("Sprite bounds:",c),console.log("Partner bounds:",S),b.Geom.Intersects.RectangleToRectangle(c,S))console.log("Collision detected! Finalizing pair"),this.finalizePair(n);else{console.log("No collision detected. Resetting position");const g=i.get(n);g&&(this.movements.push({sprite:n,destination:g}),this.physics.moveTo(n,g.x,g.y,this.resetPositionSpeed))}i.delete(n)})}distinctColors=[15079755,3978315,16769305,4416472,16089649,9510580,4379892,15741670,12578629,16432852,4626832,14466815,10117924,16775880,8388608,11206595,8421376,16767153,117,11119017,16777215,0];quadrants=[];pairsRemaining=0;shapePairMap=new Map;backButton;addBackButton(){this.backButton=this.add.text(10,10,"←",{fontSize:"48px",color:"white"}).setOrigin(0).setPadding(20,0,20,10).setStyle({backgroundColor:"#111"}).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.switch(u.TitleScene)}).setDepth(10).on("pointerover",()=>this.backButton.setStyle({fill:"#f39c12"})).on("pointerout",()=>this.backButton.setStyle({fill:"#FFF"}))}addPlayAgainButton(){this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Play Again",{fontSize:"48px",color:"white"}).setOrigin(.5).setPadding(50).setResolution(10).setStyle({backgroundColor:"green"}).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.restart()}).setDepth(10).on("pointerover",()=>this.backButton.setStyle({fill:"#f39c12"})).on("pointerout",()=>this.backButton.setStyle({fill:"#FFF"}))}finishRound(){_(this,"victory"),this.addPlayAgainButton()}reset(){console.log("Resetting game state"),this.quadrants=[],this.pairsRemaining=0;for(const[e]of this.shapePairMap)e&&e.active&&e.destroy();this.shapePairMap.clear(),this.input.removeAllListeners(),this.movements=[];const t=[...this.children.list];for(const e of t)e&&e.destroy&&e.destroy();this.backButton?.destroy()}finalizePair(t){const e=this.shapePairMap.get(t);t.disableInteractive(),e?.disableInteractive(),t.x=e.x,t.y=e.y,this.pairsRemaining--,console.log("Pair completed! Remaining pairs:",this.pairsRemaining),_(this,"whoosh"),this.tweens.add({targets:[t,e],duration:50,scaleX:1.2,scaleY:1.2,yoyo:!0,onComplete:()=>{this.tweens.add({targets:[t,e],duration:50,scaleX:.001,scaleY:.001,onComplete:()=>{t.destroy(),e.destroy(),console.log("Tween completed. Checking if game is finished. Pairs remaining:",this.pairsRemaining),this.pairsRemaining<=0&&(console.log("Game finished! Calling finishRound()"),this.finishRound())}})}})}movements=[];update(t,e){this.processMovements()}processMovements(){for(let t=this.movements.length-1;t>=0;t--){const e=this.movements[t],i=this.resetPositionSpeed*1.5/this.game.loop.targetFps,s=b.Math.Distance.BetweenPoints(e.sprite,e.destination);e.sprite.body.speed>0&&s<i&&(e.sprite.body.reset(e.destination.x,e.destination.y),this.movements.splice(t,1))}}calculateQuadrants(t,e){let i=this.scale.gameSize.width;const s=i/t,n=this.scale.gameSize.height,a=n/e;for(let l=0;l<n;l+=a)for(let c=0;c<i;c+=s){const f={x:c,y:l,centerX:c+s/2,centerY:l+a/2,width:s,height:a};this.quadrants.push(f)}}drawQuadrants(){for(const t of this.quadrants){const e=this.add.graphics();e.strokeRect(t.x,t.y,t.width,t.height),e.stroke()}}makeDraggable(t){t.setInteractive(this.input.makePixelPerfect()),this.input.setDraggable(t)}createShapePair(t,e,i){const s=p(30,120),n=Math.min(e.width,e.height)/2.1,a=this.createCirclePart(t,n,0,s);this.makeDraggable(a),a.x=e.centerX,a.y=e.centerY;const l=this.createCirclePart(t,n,s,360);this.makeDraggable(l),l.x=i.centerX,l.y=i.centerY,this.shapePairMap.set(a,l),this.shapePairMap.set(l,a),console.log("Created shape pair. Total shape pairs in map:",this.shapePairMap.size/2)}createCirclePart(t,e,i,s){var n=this.add.graphics();n.fillStyle(t,1),n.lineStyle(3,0,1),n.beginPath(),n.arc(e,e,e,b.Math.DegToRad(s),b.Math.DegToRad(i),!0),n.lineTo(e,e),n.fillPath(),n.strokePath(),n.arc(e,e,e,b.Math.DegToRad(s),b.Math.DegToRad(i),!0),n.strokePath();const a="texture"+this.textureIndex++;return n.generateTexture(a,e*2,e*2),n.destroy(),this.physics.add.sprite(e,e,a)}textureIndex=0}class it extends b.Scene{buildTimestamp;constructor(){super(u.TitleScene)}preload(){this.load.image("bubble-tile","assets/images/bubble-tile.png"),this.load.image("shape-tile","assets/images/shape-tile.png")}create(){const t=new URLSearchParams(window.location.search).get("game");t&&this.scene.switch(t),this.add.image(this.cameras.main.centerX-250,this.cameras.main.centerY,"bubble-tile").setDisplaySize(300,300).setInteractive().on("pointerdown",()=>{this.scene.switch(u.BubblePopScene)});const e=this.add.text(this.cameras.main.centerX-250,this.cameras.main.centerY,"Bubble Popper",{fontSize:"35px",color:"white"}).setOrigin(.5).setResolution(10).setPadding(5).setStyle({backgroundColor:"#111"}).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.switch(u.BubblePopScene)}).on("pointerover",()=>e.setStyle({fill:"#f39c12"})).on("pointerout",()=>e.setStyle({fill:"#FFF"}));this.add.image(this.cameras.main.centerX+250,this.cameras.main.centerY,"shape-tile").setDisplaySize(300,300).setInteractive().on("pointerdown",()=>{this.scene.switch(u.ShapeRepairScene)});const i=this.add.text(this.cameras.main.centerX+250,this.cameras.main.centerY,"Shapes",{fontSize:"35px",color:"white"}).setOrigin(.5).setResolution(10).setPadding(75,5,75,5).setStyle({backgroundColor:"#111"}).setInteractive({useHandCursor:!0}).on("pointerdown",()=>{this.scene.switch(u.ShapeRepairScene)}).on("pointerover",()=>i.setStyle({fill:"#f39c12"})).on("pointerout",()=>i.setStyle({fill:"#FFF"}));this.buildTimestamp=this.add.text(this.cameras.main.width-10,this.cameras.main.height-10,"Build: 2025-07-02 02:09",{fontSize:"12px",color:"#FFFFFF",fontFamily:"monospace"}).setOrigin(1,1).setDepth(100),this.scale.on("resize",this.handleResize,this)}handleResize(){this.buildTimestamp&&this.buildTimestamp.setPosition(this.cameras.main.width-10,this.cameras.main.height-10)}update(t,e){}}const L=new b.Game({type:b.AUTO,parent:"game",backgroundColor:"#33A5E7",scale:{width:800,height:600,mode:b.Scale.RESIZE,autoCenter:b.Scale.CENTER_BOTH},physics:{default:"arcade"}});L.scene.add(u.TitleScene,it);L.scene.add(u.ShapeRepairScene,st);L.scene.add(u.BubblePopScene,et);L.scene.start(u.TitleScene);
